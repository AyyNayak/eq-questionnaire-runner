{%- macro label(answer) %}
  {% set attr = {
    "class": "label",
    "for": answer.id,
    "id": "label-" ~ answer.id
  } %}
  <label {{attr|xmlattr}}>{{answer.label}}</label>
{% endmacro -%}

{%- macro input(type, question, answer) %}
  {% set special_types = {
    'currency': 'Â£',
    'percentage': '%'
  } %}

  {% if type in special_types %}
    {% set input_type = 'text' %}
    {% set input_has_special_type = true %}
  {% else %}
    {% set input_type = type %}
    {% set input_has_special_type = false %}
  {% endif %}

  {% set attr = {
    "class": "input input--" ~ input_type,
    "type": input_type,
    "value": (answer.value or answer.input or '')|e,
    "name": answer.id,
    "id": answer.id,
    "placeholder": answer.placeholder,
    "aria-describedby": "description-" ~ question.id ~ " guidance-" ~ answer.id ~ "-trigger"
  } %}

  {% set input_element %}
    <input {{attr|xmlattr}}>
  {% endset %}

  {% if input_has_special_type %}
    <div class="input-type input-type--{{type}}" data-type="{{special_types[type]}}">
      {{input_element|safe}}
    </div>
  {% else %}
    {{input_element|safe}}
  {% endif %}

{% endmacro -%}

{% macro textarea(question, answer) %}
  {% set maxChars = "2000" %}
  {% set answer_helper = answer.id ~ "-helper" %}
  {% set attr = {
    "class": "input input--textarea js-charlimit-input",
    "name": answer.id,
    "id": answer.id,
    "placeholder": answer.placeholder,
    "rows": "8",
    "cols": "60",
    "data-maxlength": maxChars,
    "aria-describedby": answer_helper
  } %}

  <textarea {{attr|xmlattr}}>{{(answer.value or "")|e}}</textarea>

  {% if maxChars %}
    <div class="input__helper" id="{{answer_helper}}">
      <span class="js-charlimit-label" data-remaining-msg="{{_('Characters remaining')}}">{{_('Maximum characters')}}</span>: <span class="js-charlimit-msg">{{maxChars}}</span>
    </div>
  {% endif %}
{% endmacro %}

{%- macro select(name, values, default_value, answer) %}
  <select class="input input--select" name="{{answer.id}}-{{name}}" id="{{answer.id}}-{{name}}">
    {% for value in values -%}
      <option value="{{loop.index}}" {{'selected' if loop.index == default_value}}>{{value}}</option>
    {%- endfor -%}
  </select>
{% endmacro -%}

{%- macro errorTracking(id, errorMsg) -%}
  {% set attr = {
    "data-error": "true",
    "data-error-id": id,
    "data-error-msg": errorMsg
  } %}
  {{attr|xmlattr}}
{%- endmacro -%}
