{% import 'macros/forms.html' as form %}

<div class="question {% if question.error %}question--has-errors{% endif %}" id="question-{{question.id}}">
  {%- if question.error %}
    <div class="question__error">
      Vestibulum id ligula porta felis euismod semper. Donec ullamcorper nulla non metus auctor fringilla. Maecenas faucibus mollis interdum. Praesent commodo cursus magna, vel scelerisque nisl consectetur et.
    </div>
  {% endif %}
  <fieldset class="question__fieldset">
    <legend class="question__legend">
      <div class="question__title">{{question.title}}</div>
      {%- if question.subtitle -%}
        <div class="question__subtitle">{{question.subtitle}}</div>
      {%- endif %}
    </legend>
    {%- if question.description %}
      <div class="question__description" id="description-{{question.id}}">
        {{question.description|safe}}
      </div>
    {% endif %}
    <div class="question__responses">
    {% set grid = question.responses|length > 1 and question.responses[0].type!='DateRange'%}
    {% set grid = false %}

    {%- if grid %} <div class="grid grid--align-bottom"> {% endif -%}
      {%- for response in question.responses -%}
        {%- if grid -%} <div class="grid__col m-6"> {%- endif %}
        <div class="question__response response">
          <div class="response__field field field--{{response.type|lower}}">
            {% include 'partials/responses/' ~ response.type|lower ~ '.html' %}
            {% if response.guidance %}
              {% include 'partials/guidance.html' %}
            {% endif %}
          </div>

          {% set validation_result = questionnaire.validation_results.get_result(response.id) %}
          {% if validation_result %}
            {% if not validation_result.is_valid %}
              {% if validation_result.get_errors() %}
              <ul class="errors">
                {% for error in validation_result.get_errors() %}
                <li>{{ error }}</li>
                {% endfor %}
              </ul>
              {% endif %}
              {% if validation_result.get_warnings() %}
              <ul class="warnings">
                {% for warning in validation_result.get_warnings() %}
                <li>{{ warning }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            {% endif %}
          {% endif %}

          {% if questionnaire.user_responses.get_response(response.id) %}
          <p>You entered: {{ questionnaire.user_responses.get_response(response.id) }}</p>
          {% endif %}
          
        </div>
        {%- if grid %} </div> {% endif -%}
      {%- endfor -%}
    {%- if question.grid %}</div>{% endif %}
    </div>
  </fieldset>
</div>
